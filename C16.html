<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ä¸€å¹´çº§é“å¾·æ•™è‚²å°æ¸¸æˆ</title>

<style>
:root{
  --bg:#fafafa;
  --card:#ffffff;
  --shadow:0 0 10px rgba(0,0,0,.08);
  --gap:clamp(10px, 2.4vw, 20px);
  --radius:16px;
  --fs:clamp(20px, 3.8vw, 30px);
  --h2:clamp(30px, 5.2vw, 56px);
  --c2:#99DBF5;  /* æµ…è“ */
  --c3:#A7ECEE;  /* è–„è· */
}

*{ box-sizing:border-box; }

.cornerTag{
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 10001;
  pointer-events: none;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.cornerTag img{
  height: 18px;
  width: auto;
  display: block;
  flex: 0 0 auto;
}
.cornerTag > span{
  font-size: 14px;
  line-height: 1;
  color: rgba(0,0,0,.75);
  white-space: nowrap;
}
.cornerTag .en{
  font-size: 12px;
  display: inline-block;
  transform: translateY(-0.03em);
}

body{
  margin:0;
  padding:clamp(10px, 3vw, 20px);
  font-family:"KaiTi";
  background:var(--bg);
  font-size:var(--fs);
  line-height:1.35;
  font-weight:bold;
  background: linear-gradient(180deg, var(--c2), #ffffff 55%, var(--c3));
}

.lead{ margin: 4px 0 14px; }

.container{
  max-width:1100px;
  margin:0 auto;
}

.section{
  background:var(--card);
  border-radius:var(--radius);
  padding:clamp(14px, 3vw, 24px);
  margin:0 0 var(--gap);
  box-shadow:var(--shadow);
}

h2{
  font-family:"KaiTi";
  font-size:var(--h2);
  text-align:center;
}

#pageTitle{
  width: min(1200px, 100%);
  margin: 20px auto 0px;
  text-align: center;
  font-size: var(--h2);
  font-weight: 800;
  line-height: 2;

  text-shadow:
    -2px -2px 0 #fff,  2px -2px 0 #fff,
    -2px  2px 0 #fff,  2px  2px 0 #fff,
     0   -2px 0 #fff,  0    2px 0 #fff,
    -2px  0   0 #fff,  2px  0   0 #fff,
     0    4px 10px rgba(0,0,0,.18);
}

/* é€šç”¨æç¤º */
.success{
  text-align:center;
  font-size:clamp(26px, 4.6vw, 40px);
  margin-top:clamp(10px, 2.2vw, 18px);
  display:none;
  color:#1aa260;
}
.hint{
  text-align:center;
  font-size:clamp(22px, 4vw, 34px);
  margin-top:clamp(10px, 2vw, 16px);
  display:none;
  color:#323232;
}

/* ========= ç¬¬ä¸€é¢˜ ========= */
.qblock{
  display:grid;
  gap:var(--gap);
  grid-template-columns:1fr; /* ä»»ä½•å°ºå¯¸éƒ½ä¸Šä¸‹æ’åˆ—ï¼ˆé€‰é¡¹æ°¸è¿œåœ¨ä¸Šï¼‰ */
}

/* é€‰é¡¹åŒº / å›¾ç‰‡åŒº */
.options, .answers{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:var(--gap);
}

/* draggable è§¦æ§ä¼˜åŒ– */
.option, .word{
  touch-action:none;
  user-select:none;
}

.option{
  background: linear-gradient(180deg, #D4F6FF, #C6E7FF);
  padding:clamp(10px, 1.3vw, 10px) clamp(10px, 1.3vw, 10px);
  border-radius:14px;
  cursor:grab;
  box-shadow:var(--shadow);
  margin-top:0px
}

.options .option{
  text-align: center;
  white-space: nowrap;      /* æ–‡å­—ä¸æ¢è¡Œ */
  overflow-wrap: normal;
  word-break: keep-all;
  flex: 0 0 calc(20% - (var(--gap) / 2)); /* æ¯ä¸ªå åŠè¡Œï¼Œå¼ºåˆ¶ä¸¤åˆ— */
}
.drop-box{
  flex: 0 0 calc(50% - (var(--gap) / 2)); /* æ¯ä¸ªå åŠè¡Œï¼Œå¼ºåˆ¶ä¸¤åˆ— */
  width:clamp(140px, 24vw, 200px);
  height:clamp(170px, 26vw, 240px);
  border:2px dashed #aaa;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:8px;
  background:#fff;
  text-align: center;
}

.drop-box img{
  width:100%;
  height:clamp(95px, 16vw, 150px);
  object-fit:contain;
  pointer-events:none;
}

/* ========= ç¬¬ä¸‰é¢˜ ========= */
.words{
  display:flex;
  flex-wrap:wrap;
  gap:var(--gap);
  justify-content:center;
  margin-top:clamp(8px, 2vw, 14px);
}

.word{
  background:#fff3e0;
  padding:clamp(10px, 5vw, 10px) clamp(10px, 5vw, 10px) ;
  border-radius:12px;
  cursor:grab;
  box-shadow:var(--shadow);
}

.answer-line{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:clamp(6px, 1.5vw, 10px);
  margin-top:clamp(10px, 2.2vw, 18px);
  flex-wrap:wrap;
}

.slot{
  border:2px dashed #aaa;
  border-radius:12px;
  min-height:clamp(46px, 8vw, 56px);
  display:flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  padding:4px 4px;
}

.slot.len2{ width: 4em; }
.slot.len3{ width: 5em; }
.slot.len4{ width: 6em; }

.punct{
  font-size:var(--fs);
  line-height:1;
}

/* æ”¾è¿›æ ¼å­åçš„è¯ */
.slot .word{
  margin:0;
  box-shadow:none;
}
.locked{
  opacity: .45;
  filter: grayscale(.15);
}
.locked, .locked *{
  pointer-events: none;  /* é”ä½äº¤äº’ */
}

/* ===== æ‰‹æœºï¼šq1a/q1b æ ¼å­å›ºå®š 2x2ï¼›é€‰é¡¹åŒä¸€æ’ ===== */
@media (min-width: 900px){
  :root{
    --fs: 22px;   /* ç”µè„‘å†…æ–‡å­—ä½“ */
    --h2: 40px;   /* ç”µè„‘æ ‡é¢˜å­—ä½“ */
  }
}

@media (max-width: 700px){
  #q1a .options, #q1b .options{
    flex-wrap: wrap;
    overflow-x: visible;
    -webkit-overflow-scrolling: touch;
    justify-content: center;
    gap: 14px;
    padding: 6px 4px 10px;
  }

  #q1a .answers, #q1b .answers{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    justify-items: center;
    gap: 14px;
  }

  #q1a .drop-box, #q1b .drop-box{
    width: 100%;
    max-width: 230px;
  }
}

/* ===== åº•éƒ¨æŒ‰é’®ï¼ˆPNGï¼‰ ===== */
#controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:2px;
  margin:24px 0 10px;
  padding-bottom: 10px;
  background: transparent;
  position: sticky;
  bottom: 0;
  z-index: 50;
}

#controls::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,.0), rgba(255,255,255,.85));
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 0;
  pointer-events:none;
}

#controls button{
  position: relative; /* ç¡®ä¿æŒ‰é’®åœ¨åŠé€æ˜å±‚ä¸Šé¢ */
  z-index: 1;
}

/* ç»Ÿä¸€åšæˆå›¾ç‰‡æŒ‰é’® */
#controls .img-btn{
  width: clamp(80px, 22vw, 160px);   /* æŒ‰é’®å®½åº¦ï¼Œå¯è‡ªè¡Œè°ƒ */
  height: clamp(26px, 7vw, 60px);    /* æŒ‰é’®é«˜åº¦ï¼Œå¯è‡ªè¡Œè°ƒ */
  border: none;
  padding: 0;
  cursor: pointer;
  background: transparent no-repeat center / contain;
  -webkit-tap-highlight-color: transparent;
}

/* ä¸¤å¼ å›¾ */
#controls .img-restart{
  background-image: url("images/btn_restart.png");
}
#controls .img-home{
  background-image: url("images/btn_home.png");
}

/* æŒ‰ä¸‹åé¦ˆ */
#controls .img-btn:active{
  transform: scale(0.98);
}

</style>
</head>

<body>
<div class="cornerTag">
  <img src="images/Delima.png" alt="">
  <span>ä¸€å¹´çº§é“å¾·æ•™è‚² <span class="en">(KP2027)</span> ç¬¬ <span class="en">16</span> è¯¾ ç¬¬ <span class="en">69</span> é¡µ</span>
  </div>
<div class="container">
<h2 id="pageTitle">é©¬æ¥è¥¿äºšæœ‰å“ªäº›æ—ç¾¤ï¼Ÿ</h2>
  <!-- ================= ç¬¬ä¸€é¢˜ï¼ˆå¤–å±‚é¢˜å¡ï¼‰ ================= -->
  <div class="section">
    <p class="lead">æŠŠæ­£ç¡®çš„ç­”æ¡ˆæ‹–åˆ°å›¾ç‰‡ä¸‹é¢ã€‚</p>

    <!-- q1a -->
    <div class="section" id="q1a">
      <div class="qblock">
        <div class="options" aria-label="q1a options">
          <div class="option" draggable="true">åæ—</div>
          <div class="option" draggable="true">å°åº¦æ—</div>
          <div class="option" draggable="true">é©¬æ¥æ—</div>
          <div class="option" draggable="true">ç›ç¾é‡Œæ—</div>
        </div>

        <div class="answers" aria-label="q1a answers">
          <div class="drop-box" data-answer="é©¬æ¥æ—"><img src="images/malay.png" alt="é©¬æ¥æ—"></div>
          <div class="drop-box" data-answer="åæ—"><img src="images/chinese.png" alt="åæ—"></div>
          <div class="drop-box" data-answer="ç›ç¾é‡Œæ—"><img src="images/mahmeri.png" alt="ç›ç¾é‡Œæ—"></div>
          <div class="drop-box" data-answer="å°åº¦æ—"><img src="images/indian.png" alt="å°åº¦æ—"></div>
        </div>
      </div>
      <div class="success">ğŸ‰å›ç­”æ­£ç¡®ï¼ğŸŒŸ</div>
      <div class="hint">ğŸ¤” æƒ³ä¸€æƒ³ï¼Œå†å›ç­” ğŸ¤</div>
    </div>

    <!-- q1b -->
    <div class="section" id="q1b">
      <div class="qblock">
        <div class="options" aria-label="q1b options">
          <div class="option" draggable="true">é”¡å…‹æ—</div>
          <div class="option" draggable="true">ä¼Šç­æ—</div>
          <div class="option" draggable="true">å¡è¾¾å±±æœé¡ºæ—</div>
          <div class="option" draggable="true">å³‡å³‡å¨˜æƒ¹</div>
        </div>

        <div class="answers" aria-label="q1b answers">
          <div class="drop-box" data-answer="ä¼Šç­æ—"><img src="images/iban.png" alt="ä¼Šç­æ—"></div>
          <div class="drop-box" data-answer="å¡è¾¾å±±æœé¡ºæ—"><img src="images/kadazan.png" alt="å¡è¾¾å±±æœé¡ºæ—"></div>
          <div class="drop-box" data-answer="å³‡å³‡å¨˜æƒ¹"><img src="images/babanyoya.png" alt="å³‡å³‡å¨˜æƒ¹"></div>
          <div class="drop-box" data-answer="é”¡å…‹æ—"><img src="images/sikh.png" alt="é”¡å…‹æ—"></div>
        </div>
      </div>
      <div class="success">ğŸ‰å›ç­”æ­£ç¡®ï¼ğŸŒŸ</div>
      <div class="hint">ğŸ¤” æƒ³ä¸€æƒ³ï¼Œå†å›ç­” ğŸ¤</div>
    </div>

  </div><!-- /ç¬¬ä¸€é¢˜å¤–å±‚ section -->

  <!-- ================= ç¬¬ä¸‰é¢˜ ================= -->
  <div class="section" id="q2">
    <h2>æ’ä¸€æ’å¥å­</h2>

    <div class="words" id="q2Words">
      <div class="word" draggable="true">çœŸå¼€å¿ƒ</div>
      <div class="word" draggable="true">å­¦ä¹ </div>
      <div class="word" draggable="true">å„æ—åŒå­¦</div>
      <div class="word" draggable="true">ä¸€èµ·</div>
      <div class="word" draggable="true">æˆ‘å’Œ</div>
    </div>

    <div class="answer-line" id="q2Answer">
      <div class="slot len2" data-answer="æˆ‘å’Œ"></div>
      <div class="slot len4" data-answer="å„æ—åŒå­¦"></div>
      <div class="slot len2" data-answer="ä¸€èµ·"></div>
      <div class="slot len2" data-answer="å­¦ä¹ "></div>
      <span class="punct">ï¼Œ</span>
      <div class="slot len3" data-answer="çœŸå¼€å¿ƒ"></div>
      <span class="punct">ï¼</span>
    </div>

    <div class="success" id="success3">
      ğŸŒŸæ­å–œå›ç­”æ­£ç¡®ï¼ğŸ‰<br><br>
      <div class="hint">ğŸ¤” æƒ³ä¸€æƒ³ï¼Œå†å›ç­” ğŸ¤</div>
      <b>ä½ æ‡‚å¾—å°Šé‡å„æ—ç¾¤ï¼ŒçœŸæ£’ï¼</b>
    </div>
  </div>

</div><!-- /container -->

<footer id="controls">
  <!-- å·¦è¾¹ï¼šè¿”å› -->
  <button type="button" id="backBtn" class="img-btn img-home" aria-label="è¿”å›"></button>

  <!-- å³è¾¹ï¼šé‡æ–°å¼€å§‹ -->
  <button type="button" id="restartAll" class="img-btn img-restart" aria-label="é‡æ–°å¼€å§‹"></button>
</footer>


<script>
function flashHint(sectionEl){
  if(!sectionEl) return;
  const hint = sectionEl.querySelector(".hint");
  if(!hint) return;

  hint.style.display = "block";

  // ====== ä½ å¯ä»¥è°ƒçš„æ•°å€¼ ======
  const HINT_GAP = 12;  // hint è·ç¦»åº•æ¡ä¸Šç¼˜ç•™å¤šå°‘åƒç´ ï¼ˆä½ å¯æ”¹ 6 / 20 / 30ï¼‰
  // ===========================

  requestAnimationFrame(()=>{
    const rect = hint.getBoundingClientRect();
    const safeBottom = window.innerHeight - CONTROLS_H; // åº•æ¡ä¸Šç¼˜

    // å¦‚æœ hint è¢«åº•æ¡ç›–åˆ°ï¼ˆrect.bottom è¶…è¿‡ safeBottomï¼‰ï¼Œåªæ»šâ€œåˆšåˆšå¥½â€çš„è·ç¦»
    if(rect.bottom > safeBottom - HINT_GAP){
      const delta = rect.bottom - (safeBottom - HINT_GAP);
      window.scrollBy({ top: delta, behavior: "smooth" });
    }
    // å¦‚æœ hint åœ¨å±å¹•ä¸Šæ–¹çœ‹ä¸åˆ°ï¼Œä¹Ÿåªæ»šåˆšå¥½è®©å®ƒå‡ºç°
    else if(rect.top < 0 + HINT_GAP){
      const delta = rect.top - HINT_GAP;
      window.scrollBy({ top: delta, behavior: "smooth" });
    }
  });

  if(hint._t) clearTimeout(hint._t);
  hint._t = setTimeout(()=>{ hint.style.display = "none"; }, 2000);
}


// ====== ä½ å¯ä»¥è°ƒçš„æ•°å€¼ ======
const CONTROLS_H = 120;  // åº•æ¡å¤§çº¦é«˜åº¦ï¼ˆå« paddingï¼‰ï¼Œä½ å¯ä»¥æ”¹å¤§/æ”¹å°
const LOCK_PAD   = 16;   // å…è®¸å¤šæ»šä¸€ç‚¹ç‚¹çš„ç¼“å†²ï¼ˆè¶Šå°è¶Šâ€œä¸¥æ ¼â€ï¼‰

let unlockedQ1B = false;
let unlockedQ2  = false;

function lockSection(id, locked){
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.toggle("locked", locked);
  el.setAttribute("aria-disabled", locked ? "true" : "false");
}

function getScrollLimitY(){
  // æ²¡è§£é” Q1Bï¼šæœ€å¤šçœ‹åˆ° q1a
  // è§£é” Q1B ä½†æ²¡è§£é” Q2ï¼šæœ€å¤šçœ‹åˆ° q1b
  // è§£é” Q2ï¼šæœ€å¤šçœ‹åˆ° q2ï¼ˆä¹‹åä½ è¦ä¸è¦è§£é™¤é™åˆ¶å¯å†è¯´ï¼‰
  const anchorId = !unlockedQ1B ? "q1a" : (!unlockedQ2 ? "q1b" : "q2");
  const el = document.getElementById(anchorId);
  if(!el) return Infinity;

  const rect = el.getBoundingClientRect();
  const bottomDocY = window.scrollY + rect.bottom;

  // safeBottom = å±å¹•åº•æ¡ä¸Šç¼˜
  const safeBottom = window.innerHeight - CONTROLS_H;

  // è®© anchor çš„åº•éƒ¨æœ€å¤šåˆ° safeBottom ä¸Šæ–¹ä¸€ç‚¹ç‚¹
  return Math.max(0, bottomDocY - safeBottom + LOCK_PAD);
}

let _locking = false;
function enforceScrollLimit(){
  if(_locking) return;
  const maxY = getScrollLimitY();
  if(window.scrollY > maxY){
    _locking = true;
    window.scrollTo({ top: maxY, behavior: "auto" });
    _locking = false;
  }
}
window.addEventListener("scroll", enforceScrollLimit, { passive: true });
window.addEventListener("resize", enforceScrollLimit);

/* ================= æ¡Œé¢ç«¯ï¼šHTML5 drag & drop ================= */
let dragged = null;

document.querySelectorAll(".option, .word").forEach(el=>{
  el.addEventListener("dragstart", e => dragged = e.target);
});

document.querySelectorAll(".drop-box").forEach(box=>{
  box.addEventListener("dragover", e => e.preventDefault());
  box.addEventListener("drop", e=>{
    e.preventDefault();
    if(!dragged) return;

    const text = dragged.innerText.trim();
    if(!dragged.classList.contains("option")) return; // åªå…è®¸ option æŠ•æ”¾åˆ° drop-box
    if(text !== box.dataset.answer){
  flashHint(box.closest(".section")); // q1a æˆ– q1b
  return;
}
    const existing = box.querySelector(".option");
    if(existing){
      box.closest(".section").querySelector(".options").appendChild(existing);
    }

    box.appendChild(dragged);
    dragged = null;
    checkQ1();
  });
});

// ç¬¬ä¸‰é¢˜ï¼šslot drop
document.querySelectorAll("#q2Answer .slot").forEach(slot=>{
  slot.addEventListener("dragover", e => e.preventDefault());
  slot.addEventListener("drop", e=>{
    e.preventDefault();
    if(!dragged) return;
    if(!dragged.classList.contains("word")) return;

    const existing = slot.querySelector(".word");
    if(existing) document.getElementById("q2Words").appendChild(existing);

    slot.appendChild(dragged);
    if(dragged.innerText.trim() !== slot.dataset.answer){
      flashHint(document.getElementById("q2"));
}

    dragged = null;
    checkQ2();
  });
});

// ç¬¬ä¸‰é¢˜ï¼šæ‹–å›é€‰é¡¹åŒº
const q2Words = document.getElementById("q2Words");
q2Words.addEventListener("dragover", e => e.preventDefault());
q2Words.addEventListener("drop", e=>{
  e.preventDefault();
  if(!dragged) return;
  if(!dragged.classList.contains("word")) return;
  q2Words.appendChild(dragged);
  dragged = null;
  checkQ2();
});

/* ================= æ‰‹æœºç«¯ï¼šPointer è§¦æ§æ‹–æ”¾ ================= */
let pointerDrag = { el:null, ghost:null, offsetX:0, offsetY:0, active:false };

function isTouchPointer(e){
  return e.pointerType === "touch" || e.pointerType === "pen";
}

function startPointerDrag(e, el){
  pointerDrag.el = el;
  pointerDrag.active = true;

  const r = el.getBoundingClientRect();
  pointerDrag.offsetX = e.clientX - r.left;
  pointerDrag.offsetY = e.clientY - r.top;

  const ghost = el.cloneNode(true);
  ghost.style.position = "fixed";
  ghost.style.left = (e.clientX - pointerDrag.offsetX) + "px";
  ghost.style.top  = (e.clientY - pointerDrag.offsetY) + "px";
  ghost.style.zIndex = 9999;
  ghost.style.opacity = "0.9";
  ghost.style.pointerEvents = "none";
  ghost.style.transform = "scale(1.02)";
  document.body.appendChild(ghost);
  pointerDrag.ghost = ghost;
}

function movePointerDrag(e){
  if(!pointerDrag.active || !pointerDrag.ghost) return;
  pointerDrag.ghost.style.left = (e.clientX - pointerDrag.offsetX) + "px";
  pointerDrag.ghost.style.top  = (e.clientY - pointerDrag.offsetY) + "px";
}

function endPointerDrag(e){
  if(!pointerDrag.active) return;

  const el = pointerDrag.el;
  const ghost = pointerDrag.ghost;
  const target = document.elementFromPoint(e.clientX, e.clientY);

  // 1) ç¬¬ä¸€é¢˜ï¼šdrop-box
  const dropBox = target && target.closest && target.closest(".drop-box");
  if(dropBox && el.classList.contains("option")){
    const text = el.innerText.trim();

    if(text === dropBox.dataset.answer){
      const existing = dropBox.querySelector(".option");
      if(existing){
        dropBox.closest(".section").querySelector(".options").appendChild(existing);
      }
      dropBox.appendChild(el);
      checkQ1();
    }else{
      flashHint(dropBox.closest(".section")); // æ”¾é”™æç¤º
    }
  }

  // 2) ç¬¬äºŒé¢˜ï¼šslot
  const slot = target && target.closest && target.closest("#q2Answer .slot");
  if(slot && el.classList.contains("word")){
    const existing = slot.querySelector(".word");
    if(existing) document.getElementById("q2Words").appendChild(existing);

    slot.appendChild(el);

    if(el.innerText.trim() !== slot.dataset.answer){
      flashHint(document.getElementById("q2"));
    }

    checkQ2();
  }

  // 3) ç¬¬äºŒé¢˜ï¼šæ‹–å›é€‰é¡¹åŒº
  const wordsArea = target && target.closest && target.closest("#q2Words");
  if(wordsArea && el.classList.contains("word")){
    wordsArea.appendChild(el);
    checkQ2();
  }

  if(ghost) ghost.remove();
  pointerDrag = { el:null, ghost:null, offsetX:0, offsetY:0, active:false };
}

document.querySelectorAll(".option, .word").forEach(el=>{
  el.addEventListener("pointerdown", (e)=>{
    if(!isTouchPointer(e)) return;
    e.preventDefault();
    el.setPointerCapture(e.pointerId);
    startPointerDrag(e, el);
  });

  el.addEventListener("pointermove", (e)=>{
    if(!isTouchPointer(e)) return;
    if(!pointerDrag.active) return;
    e.preventDefault();
    movePointerDrag(e);
  });

  el.addEventListener("pointerup", (e)=>{
    if(!isTouchPointer(e)) return;
    e.preventDefault();
    endPointerDrag(e);
  });

  el.addEventListener("pointercancel", (e)=>{
    if(!isTouchPointer(e)) return;
    endPointerDrag(e);
  });
});

/* ================= æ£€æŸ¥é€»è¾‘ + reset ================= */
let didAutoScroll = false;
let didScrollToQ1b = false;
let didScrollToQ2  = false;

function isSectionDone(id){
  const sec = document.getElementById(id);
  if(!sec) return false;
  return [...sec.querySelectorAll(".drop-box")].every(b => b.querySelector(".option"));
}


function isQ1AllDone(){
  return ["q1a","q1b"].every(id=>{
    const sec = document.getElementById(id);
    if(!sec) return false;
    return [...sec.querySelectorAll(".drop-box")]
      .every(b => b.querySelector(".option"));
  });
}
function checkQ1(){
  const q1a = document.getElementById("q1a");
  const q1b = document.getElementById("q1b");

  const q1aDone = isSectionDone("q1a");
  const q1bDone = isSectionDone("q1b");

  // æ˜¾ç¤ºå„è‡ª success
  if(q1a && q1aDone) q1a.querySelector(".success").style.display = "block";
  if(q1b && q1bDone) q1b.querySelector(".success").style.display = "block";

  // 1) å®Œæˆ q1a -> æ»šåˆ° q1bï¼ˆåªè§¦å‘ä¸€æ¬¡ï¼‰
  if(q1aDone && !didScrollToQ1b){
    didScrollToQ1b = true;
    document.getElementById("q1b").scrollIntoView({ behavior:"smooth", block:"start" });
  }

  // 2) å®Œæˆ q1b -> æ»šåˆ°ç¬¬äºŒé¢˜ q2ï¼ˆåªè§¦å‘ä¸€æ¬¡ï¼›å¹¶ä¸”è¦æ±‚ q1a ä¹Ÿå®Œæˆï¼‰
  if(q1aDone && q1bDone && !didScrollToQ2){
    didScrollToQ2 = true;
    document.getElementById("q2").scrollIntoView({ behavior:"smooth", block:"start" });
  }

  // å¦‚æœä¹‹åè¢«ä½ â€œé‡ç½®/å˜å›æœªå®Œæˆâ€ï¼Œå…è®¸æœªæ¥å†æ¬¡è§¦å‘æ»šåŠ¨
  if(!q1aDone) didScrollToQ1b = false;
  if(!(q1aDone && q1bDone)) didScrollToQ2 = false;

  // âœ… å®Œæˆ q1a -> è§£é” q1b
  if(q1aDone && !unlockedQ1B){
  unlockedQ1B = true;
  lockSection("q1b", false);
  enforceScrollLimit();
}

// âœ… å®Œæˆ q1bï¼ˆä¸” q1aDoneï¼‰-> è§£é” q2
if(q1aDone && q1bDone && !unlockedQ2){
  unlockedQ2 = true;
  lockSection("q2", false);
  enforceScrollLimit();
  }
}

function checkQ2(){
  const slots = [...document.querySelectorAll("#q2Answer .slot")];
  const success3 = document.getElementById("success3");

  // æ²¡å¡«æ»¡ï¼šä¸æ˜¾ç¤ºæˆåŠŸï¼ŒåŒæ—¶å…è®¸æœªæ¥å†æ¬¡è§¦å‘è‡ªåŠ¨æ»šåŠ¨
  if(slots.some(s => !s.querySelector(".word"))){
    success3.style.display = "none";
    didAutoScroll = false;
    return;
  }

  const ok = slots.every(s => s.querySelector(".word").innerText.trim() === s.dataset.answer);
  success3.style.display = ok ? "block" : "none";

  // Q1 + Q2 éƒ½å®Œæˆä¸”æ­£ç¡® â†’ è‡ªåŠ¨æ»šåŠ¨ï¼ˆåªåšä¸€æ¬¡ï¼‰
  if(ok && isQ1AllDone() && !didAutoScroll){
    didAutoScroll = true;
    success3.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  // è‹¥ä¹‹åå˜å›ä¸æ­£ç¡®ï¼ˆä¾‹å¦‚ä½ å…è®¸æ‹–å›å»ï¼‰å°±è§£é™¤é”
  if(!ok) didAutoScroll = false;
}

function resetQ2(){
  const q2Words = document.getElementById("q2Words");
  const success3 = document.getElementById("success3");

  document.querySelectorAll("#q2Answer .slot .word").forEach(w=>q2Words.appendChild(w));

  ["çœŸå¼€å¿ƒ","å­¦ä¹ ","å„æ—åŒå­¦","ä¸€èµ·","æˆ‘å’Œ"].forEach(t=>{
    const el = [...q2Words.querySelectorAll(".word")].find(x=>x.innerText.trim()===t);
    if(el) q2Words.appendChild(el);
  });

  if(success3) success3.style.display = "none";
  didAutoScroll = false;
}

/* ===== åº•éƒ¨æŒ‰é’®ï¼šé‡æ–°å¼€å§‹ / è¿”å› ===== */
document.getElementById("restartAll").addEventListener("click", ()=>{
  // âœ… æ–°å¢ï¼šé‡æ–°ä¸Šé”
  unlockedQ1B = false;
  unlockedQ2  = false;
  lockSection("q1b", true);
  lockSection("q2",  true);

  didScrollToQ1b = false;
  didScrollToQ2  = false;
  didAutoScroll  = false;

  resetQ1Section("q1a", ["åæ—","å°åº¦æ—","é©¬æ¥æ—","ç›ç¾é‡Œæ—"]);
  resetQ1Section("q1b", ["é”¡å…‹æ—","ä¼Šç­æ—","å¡è¾¾å±±æœé¡ºæ—","å³‡å³‡å¨˜æƒ¹"]);
  resetQ2();
  window.scrollTo({ top: 0, behavior: "smooth" });

  // âœ… æ–°å¢ï¼šåˆ·æ–°æ»šåŠ¨ä¸Šé™
  enforceScrollLimit();
});

document.getElementById("backBtn").addEventListener("click", ()=>{
  history.back();
  // æˆ–ï¼šlocation.href = "index.html";
});
function resetQ1Section(id, order){
  const sec = document.getElementById(id);
  if(!sec) return;

  const optionsBox = sec.querySelector(".options");
  if(!optionsBox) return;

  // 1) æŠŠæ”¾è¿› drop-box çš„ option å…¨éƒ¨ç§»å› options åŒº
  sec.querySelectorAll(".drop-box .option").forEach(opt=>{
    optionsBox.appendChild(opt);
  });

  // 2) æŒ‰æŒ‡å®šé¡ºåºé‡æ–°æ’åˆ— options
  order.forEach(t=>{
    const el = [...optionsBox.querySelectorAll(".option")]
      .find(x => x.innerText.trim() === t);
    if(el) optionsBox.appendChild(el);
  });

  // 3) éšè—æˆåŠŸæç¤º
  const s = sec.querySelector(".success");
  if(s) s.style.display = "none";
}
lockSection("q1b", true);
lockSection("q2",  true);
unlockedQ1B = false;
unlockedQ2  = false;
enforceScrollLimit();


</script>

</body>
</html>
